//首页热门  alexCarousel
;(function(){

    var Carousel = function(ele, opt) {
        this.$element = ele,
        this.defaults = {
            'prevClass': 'ui-switchable-prev',
            'nextClass': 'ui-switchable-next',
            'ui-switchable-panel': 'ui-switchable-panel',
            'index': 0,
            'len':6,
            'autoPlay':true,
            'autoPlayTime':5000,
            'hoverShow': true
        },
        this.settings = $.extend({}, this.defaults, opt)
    }
    Carousel.prototype = {
        carouselMove: function() {

            var me = this.$element;
            var that = this;
            var $prevClass = me.find(".ui-switchable-prev");
            var $nextClass = me.find(".ui-switchable-next");
            var $panel = me.find(".ui-switchable-panel");
            var $main = me.find(".ui-switchable-panel-main");
            var panelLen = $panel.length;
            var panelWidth = $panel.outerWidth();

            if(panelLen < this.settings.len) return;

            $main.width(panelWidth * panelLen);

            $prevClass.bind("click",function(){
                Move('prev');
            });
            $nextClass.bind("click",function(){
                Move('next');
            });

            if(this.settings.autoPlay) {
                autoTimmer = setInterval(function () {
                    Move('next');
                }, that.settings.autoPlayTime);
            }

            me.hover(function(){
                console.info("hover");
                clearInterval(autoTimmer);
                $prevClass.show();
                $nextClass.show();
            },function(){
                console.info(that.settings.autoPlayTime);
                if(that.settings.hoverShow) {
                    $prevClass.hide();
                    $nextClass.hide();
                }
                autoTimmer = setInterval(function () {
                    Move('next');
                }, that.settings.autoPlayTime);
            });

            function Move(type){
                var tmp;
                var node = me.find(".ui-switchable-panel");
                if(type == "next") {
                    tmp = node.eq(0).clone();
                    node.eq(0).animate({
                        "margin-left" : -panelWidth
                    },function(){
                        node.eq(0).remove();
                        $main.append(tmp);
                    });
                } else {
                    tmp = node.eq(panelLen-1).clone();
                    tmp.css({
                        "margin-left":-panelWidth
                    });
                    $main.prepend(tmp);
                    me.find(".ui-switchable-panel").eq(0).animate({
                        "margin-left":0
                    },function(){
                        node.eq(panelLen).remove();
                    });
                }
            }
        }
    }
    $.fn.alexCarousel = function(options) {
        var that = this;
        $(that).each(function(i){
            return (new Carousel($(that).eq(i), options)).carouselMove()
        })
    };

})();
