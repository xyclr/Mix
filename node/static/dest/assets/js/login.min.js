//页面全屏和滚动
var loginFullPage= (function(){
    var $superContainer = $(".J-superContainer");
    var $section = $superContainer.find(".section");
    var $nav = $(".J-header-nav");
    var pageHeight = $(window).height()  - $(".login-header").height();
    var pageIndex = 0;
    var pageRang = [0,$section.length-1];
    var isScrolling = false;

    //初始化page
    var _init = function(){
        pageIndex = 0;
        $section.height(pageHeight);
    };

    //滚动到page
    var _scrollTo = function(i){
        isScrolling = true;
        $superContainer.animate({"top": -i*pageHeight + "px"},function(){
            pageIndex = i;
            isScrolling = false;
            _addAnimation(i);
        });
        $(".J-header-nav").find("li").eq(i).addClass("cur").siblings().removeClass("cur");
        $(".J-mini-nav").find("li").eq(i).addClass("cur").siblings().removeClass("cur");
    };

    //给特定元素添加动画
    var _addAnimation = function(i){
        $section.find(".animation-item").each(function(){
            var $this = $(this);
            $this.removeClass($this.attr("data-animation")).removeClass('animated');
        });
        $section.eq(i).find(".animation-item").each(function(i){
            var $this = $(this);
            $this.addClass("animated").addClass($this.attr("data-animation"));
        });
    };

    //绑定滚动事件
    var wheel = function(event) {
        var delta = 0;
        if (!event) /* For IE. */
            event = window.event;
        if (event.wheelDelta) { /* IE/Opera. */
            delta = event.wheelDelta / 120;
        } else if (event.detail) {
            /** Mozilla case. */
            /** In Mozilla, sign of delta is different than in IE.
             * Also, delta is multiple of 3.
             */
            delta = -event.detail / 3;
        }
        /** If delta is nonzero, handle it.
         * Basically, delta is now positive if wheel was scrolled up,
         * and negative, if wheel was scrolled down.
         */

        if (delta)
            handle(delta);
        /** Prevent default actions caused by mouse wheel.
         * That might be ugly, but we handle scrolls somehow
         * anyway, so don't bother here..
         */
        if (event.preventDefault)
            event.preventDefault();
        event.returnValue = false;
    };
    var wheelTimmer = null;
    var handle = function(delta) {
        if(wheelTimmer){
            clearTimeout(wheelTimmer);
        }
        wheelTimmer = setTimeout(function(){

            if (delta < 0) {
                if(pageIndex !== pageRang[1]) {
                    pageIndex = pageIndex + 1;
                } else {
                    return;
                }
            } else {
                if(pageIndex !== pageRang[0]) {
                    pageIndex = pageIndex - 1;
                } else {
                    return;
                }
            }
            _scrollTo(pageIndex);
        },80);
    };

    if (window.addEventListener) {
        /** DOMMouseScroll is for mozilla. */
        window.addEventListener('DOMMouseScroll', wheel, false);
    }
    window.onmousewheel = document.onmousewheel = wheel;

    //resize
    $(window).resize(function(){
        pageHeight = $(window).height()  - $(".login-header").height();
        _init();
        $superContainer.animate({"top": -pageIndex*pageHeight + "px"});
    });

    //nav事件
    $(".J-header-nav,.J-mini-nav").find("li").bind('click',function(){
        var $this = $(this);
        _scrollTo($this.index());
    });

    $nav.find("li").hover(function(){
        $(this).find("a.back").show().siblings().hide();
    },function(){
        $(this).find("a.front").show().siblings().hide();
    });

    return {
        init: _init,
        scrollTo: _scrollTo
    };
})(window,undefined);

loginFullPage.init();
//loginFullPage.scrollTo(3);

$("#formlogin,#contactBox").find("input[type=text],input[type=password]").focus(function(){
    console.info($(this).parents(".item"));
    $(this).parents(".item").addClass("item-focus");
}).blur(function(){
    $(this).parents(".item").removeClass("item-focus");
});