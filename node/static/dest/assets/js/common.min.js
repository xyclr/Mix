$(function(){
    //类目交互
    var categorysIdx = 0;
    var $dorpdownLayer = $(".dorpdown-layer");
    $("#categorys-vsp .dd-inner .item").not(".more").hover(function(e){
        categorysIdx = $(this).index();
        console.info(categorysIdx);
        $(this).addClass("hover").siblings().removeClass("hover");
        $dorpdownLayer.css({"margin-top":0,"height":"auto"}).show().find(".item-sub").hide().eq(categorysIdx).show();
        posDorpdownLayer(e.originalEvent.y || e.originalEvent.layerY || 0);
    },null);
    $("#categorys-vsp .dd").hover(null,function(){
        $(this).find(".item").removeClass("hover");
        $dorpdownLayer.hide().css({"margin-top":0,"height":"auto"}).find(".item-sub").hide();
    });

    $("#categorys-vsp").hover(function(){
        var $this = $(this);
        if($this.hasClass("categorys-index")) return;
        $this.find(".dt .ci-right").addClass("up").parents(".dt").next().show();
    },function(){
        var $this = $(this);
        if($this.hasClass("categorys-index")) return;
        $this.find(".dt .ci-right").removeClass("up").parents(".dt").next().hide();
    });
    //计算3级类目位置
    //$(window).scroll(function(){
    //    if($dorpdownLayer.css("display") == "block") {
    //        posDorpdownLayer();
    //    }
    //});
    function posDorpdownLayer(y){
        var scrollTop = $(window).scrollTop();
        //console.info(scrollTop);
        //console.info(y);
        console.info(categorysIdx);
        if(scrollTop >  184){
            $dorpdownLayer.css({"margin-top":scrollTop -184});
            if(categorysIdx>13) {
                console.info(y);
                console.info($dorpdownLayer.height());
                if(y > $dorpdownLayer.height()) {
                    $dorpdownLayer.height(y + 100)
                } else {
                    $dorpdownLayer.css({"height":"auto"})
                }
            } else {
                $dorpdownLayer.css({"margin-top":0,"height":"auto"})
            }
        }
    }

    //sider-bar
    $(".sider-bar .item").hover(function(){
        $(this).addClass("hover");
    },function(){
        $(this).removeClass("hover");
    });
    $(".sider-bar").hover(function(){
        $(this).addClass("hover");
    },function(){
        $(this).removeClass("hover");
    });

    $(window).scroll(function(){
        var $win = $(window);
        var $top = $(".sdier-bar-top");
        if($win.scrollTop() > $win.height()) {
            $top.css({"visibility":"visible"});
        } else {
            $top.css({"visibility":"hidden"});
        }
    }).trigger("scroll");

    if($(".sdier-bar-top").length) {
        $(".sdier-bar-top").click(function(){
            $('html, body').animate({scrollTop : 0},800);
            return false;
        });
    };
});
