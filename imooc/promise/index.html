<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">

    <title>IT教育网2015课程学习情况</title>

    <style>
        .ball1,.ball2,.ball3 {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .ball1 {
            background: red;
        }

        .ball2 {
            background: blue;
        }

        .ball3 {
            background: yellow;
        }
    </style>
<body>
<div class="ball1"></div>
<div class="ball2"></div>
<div class="ball3"></div>
<script type="text/javascript" src="../movie/node_modules/bluebird/js/browser/bluebird.js"></script>
<script>
    var Promise = window.Promise;

    function animate(ball, distance, cb){

        setTimeout(function(){
            var marginLeft = parseInt(ball.style.marginLeft || 0, 10);

            if(marginLeft === distance) {
                cb && cb();
                return false;
            } else {
                if(marginLeft < distance) {
                    marginLeft++;
                } else {
                    marginLeft--;
                }

                ball.style.marginLeft = (marginLeft + 'px');

                animate(ball, distance, cb);
            }
        },13)
    }




    function promiseAnimate(ball, distance){
        return new Promise(function(resolve, reject){
            function _animate(){
                setTimeout(function(){
                    var marginLeft = parseInt(ball.style.marginLeft || 0, 10);

                    if(marginLeft === distance) {
                        resolve();
                    } else {
                        if(marginLeft < distance) {
                            marginLeft++;
                        } else {
                            marginLeft--;
                        }

                        ball.style.marginLeft = (marginLeft + 'px');

                        _animate();
                    }
                },13);
            }
            _animate();
        })
    }


    var ball1 = document.querySelector('.ball1');
    var ball2 = document.querySelector('.ball2');
    var ball3 = document.querySelector('.ball3');

    promiseAnimate(ball1, 10)
            .then(function(){
                return promiseAnimate(ball2, 10)
            })
            .then(function(){
                return promiseAnimate(ball3, 10)
            })
            .then(function(){
                return promiseAnimate(ball3, 5)
            })
            .then(function(){
                return promiseAnimate(ball2, 5)
            })
            .then(function(){
                return promiseAnimate(ball1, 5)
            })

//    animate(ball1, 200, function(){
//        animate(ball2, 200, function(){
//            animate(ball3, 200, function(){
//                animate(ball3, 100, function(){
//                    animate(ball2, 100, function(){
//                        animate(ball1, 100, function(){
//
//                        })
//                    })
//                })
//            })
//        })
//    })

</script>
</body>

</html>